env:
  global:
    # $BOX_HOST_NAME and $BOX_PORT are also used by Selenium tests.
    - BOX_LOCAL_NAME=foxbox BOX_PORT=3000
    - BUILD_SCRIPT=general

language: rust
rust: nightly-2016-04-10
os: linux
dist: trusty
sudo: required

matrix:
  fast_finish: true
  allow_failures:
    - rust: nightly
  include:
    - os: osx
    - rust: nightly
    - env: BUILD_SCRIPT=arm_cross_compile RELEASE=true
    - env: BUILD_SCRIPT=arm_cross_compile RELEASE=false

    - env: BUILD_SCRIPT=coverage

    - env: COMPONENT=taxonomy           BUILD_SCRIPT=component
    - env: COMPONENT=thinkerbell        BUILD_SCRIPT=component
    - env: COMPONENT=tls                BUILD_SCRIPT=component
    - env: COMPONENT=dns_challenge      BUILD_SCRIPT=component
    - env: COMPONENT=openzwave-adapter  BUILD_SCRIPT=component

cache:
  directories:
    - $HOME/.cargo
    - node_modules
    - $TRAVIS_BUILD_DIR/target

addons:
  firefox: latest
  apt:
    packages:
      - libupnp-dev
      - libespeak-dev
      - libudev-dev
      # kcov
      - libcurl4-openssl-dev
      - libelf-dev
      - libdw-dev

before_install: source $TRAVIS_BUILD_DIR/tools/travis-$TRAVIS_OS_NAME-$BUILD_SCRIPT.sh
install: install_dependencies

script:
  - build
  - run_tests
